<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Temps & Dimensionnement - TSMEL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome pour les ic√¥nes du module LogistiTech -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap'); 
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f0; /* Warm Neutral */
            color: #1f2937;
        }

        /* Animations */
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 300px;
            max-height: 400px;
        }
        
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }

        .tab-active {
            border-bottom: 3px solid #ea580c; /* Orange-600 */
            color: #1e3a8a; /* Blue-900 */
            font-weight: 700;
        }
        
        .tab-inactive {
            border-bottom: 3px solid transparent;
            color: #6b7280;
            font-weight: 400;
        }
        
        .tab-inactive:hover {
            color: #1e3a8a;
            border-bottom: 3px solid #bfdbfe;
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s ease-in-out;
        }
        
        .card-shadow:hover { transform: translateY(-2px); }

        /* --- STYLES SP√âCIFIQUES MODULE LOGISTITECH (Int√©gr√©s et mis √† jour) --- */
        .log-module {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 100%;
            margin: 0 auto;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            color: #333;
        }
        .log-header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 8px 8px 0 0;
            margin: -20px -20px 20px -20px;
            text-align: center;
        }
        .log-h2 {
            color: #e67e22; /* Orange Logistique */
            border-bottom: 2px solid #e67e22;
            padding-bottom: 10px;
            margin-top: 30px;
            font-weight: bold;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* BOITES D'INFO */
        .falc-box {
            background-color: #fff;
            border-left: 5px solid #27ae60;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .alert-box {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .work-box {
            background-color: #f0f9ff;
            border: 1px dashed #3b82f6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        /* TABLEAUX EXCEL STYLE */
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9em;
            background: white;
        }
        .excel-table th {
            background-color: #ecf0f1;
            border: 1px solid #bdc3c7;
            padding: 8px;
            text-align: left;
            font-weight: bold;
        }
        .excel-table td {
            border: 1px solid #bdc3c7;
            padding: 8px;
        }
        .input-cell { background-color: #fff9c4; font-weight: bold; text-align: center; color: black;}
        .result-cell { background-color: #e8f6f3; font-weight: bold; text-align: center; }
        .formula-col { font-family: 'Consolas', monospace; color: #c0392b; font-size: 0.85em; }

        /* Style pour la zone verrouill√©e (Lock) */
        .locked-overlay {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border: 2px dashed #9ca3af;
            border-radius: 0.75rem;
            padding: 3rem;
            text-align: center;
            margin-top: 1rem;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-blue-900 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold tracking-tight">Gestion des Temps & Ressources</h1>
                <p class="mt-1 text-blue-200 text-sm">Formation TSMEL - Module AT1 / CP1</p>
            </div>
            <div class="mt-4 md:mt-0 flex space-x-2 text-sm bg-blue-800 rounded-lg p-2">
                <span class="flex items-center px-2">‚è±Ô∏è Pilotage</span>
                <span class="flex items-center px-2">‚öñÔ∏è R√©glementation</span>
                <span class="flex items-center px-2">üìä Performance</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-14 overflow-x-auto">
                <div class="flex space-x-4 md:space-x-8 w-full" id="nav-container">
                    <!-- Nav items injected via JS -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        
        <!-- View: Accueil -->
        <section id="view-home" class="hidden animate-fade-in">
            <div class="bg-white rounded-xl p-8 card-shadow mb-8">
                <h2 class="text-2xl font-bold text-blue-900 mb-4">Introduction : Le Paradoxe Logistique</h2>
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <p class="text-gray-700 leading-relaxed mb-4">
                            La logistique moderne op√®re sous une double contrainte : l'exigence de <strong>performance</strong> (fluidit√©, rapidit√© J+1) et la n√©cessit√© de <strong>l√©galit√©</strong> (respect strict du cadre social).
                        </p>
                        <div class="bg-orange-50 border-l-4 border-orange-500 p-4 mb-4">
                            <p class="font-bold text-orange-800">Le r√¥le du TSMEL</p>
                            <p class="text-sm text-orange-700">Ma√Ætriser la r√©glementation n'est pas seulement une obligation juridique, c'est un levier de rentabilit√©. Un mauvais dimensionnement entra√Æne co√ªts inutiles ou risques sociaux.</p>
                        </div>
                        <h3 class="font-bold text-gray-800 mt-6 mb-2">Objectifs du module :</h3>
                        <ul class="list-disc list-inside text-gray-600 space-y-1">
                            <li>Distinguer les cadres r√©glementaires (S√©dentaire vs Roulant).</li>
                            <li>Comprendre le calcul des ETP et du Coefficient d'Engagement.</li>
                            <li>Analyser l'ad√©quation charge/capacit√© (Cas Tropik Drive).</li>
                            <li>Planifier les ressources sous contrainte (Cas LogistiTech).</li>
                        </ul>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-6 flex flex-col justify-center items-center text-center">
                        <div class="text-6xl mb-4">‚öñÔ∏è</div>
                        <h3 class="text-xl font-bold text-blue-900">Performance vs Conformit√©</h3>
                        <p class="text-sm text-blue-700 mt-2">Le d√©fi quotidien du gestionnaire logistique.</p>
                        <button onclick="app.navigate('warehouse')" class="mt-6 px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition">Commencer le Module</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- View: Warehouse (S√©dentaire) -->
        <section id="view-warehouse" class="hidden animate-fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-blue-900">La Logistique S√©dentaire (Entrep√¥t)</h2>
                <p class="text-gray-600 mt-2">Ce module d√©taille les r√®gles du Code du Travail appliqu√©es aux pr√©parateurs de commandes et caristes. La ma√Ætrise de ces r√®gles est indispensable pour construire des plannings l√©gaux et efficaces.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <!-- Card 1 -->
                <div class="bg-white p-6 rounded-xl card-shadow border-t-4 border-blue-500">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg">Dur√©e du Travail</h3>
                        <span class="text-2xl">‚è±Ô∏è</span>
                    </div>
                    <div class="text-3xl font-bold text-gray-800 mb-2">35h</div>
                    <p class="text-sm text-gray-500 mb-4">R√©f√©rence l√©gale hebdomadaire.</p>
                    <ul class="text-sm text-gray-700 space-y-2 bg-gray-50 p-3 rounded">
                        <li class="flex justify-between"><span>Seuil Heures Supp:</span> <strong>Au-del√† de 35h</strong></li>
                        <li class="flex justify-between"><span>Max Hebdo Absolu:</span> <strong>48 h</strong></li>
                        <li class="flex justify-between"><span>Max Hebdo Moy.:</span> <strong>44 h</strong></li>
                    </ul>
                </div>
                <!-- Card 2 -->
                <div class="bg-white p-6 rounded-xl card-shadow border-t-4 border-red-500">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg">La R√®gle des 6 Heures</h3>
                        <span class="text-2xl">‚òï</span>
                    </div>
                    <p class="text-gray-700 text-sm mb-4">Imp√©ratif de sant√© et s√©curit√© (Code du Travail).</p>
                    <div class="bg-red-50 p-3 rounded border border-red-100 mb-2">
                        <p class="text-red-800 font-semibold text-sm">D√®s 6h de travail cons√©cutif ‚Üí 20 min de pause OBLIGATOIRE.</p>
                    </div>
                    <p class="text-xs text-gray-500">Exemple: Poste 5h00-12h00 (7h) = Pause obligatoire (ex: √† 9h00).</p>
                </div>
                <!-- Card 3 -->
                <div class="bg-white p-6 rounded-xl card-shadow border-t-4 border-indigo-500">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg">Travail de Nuit</h3>
                        <span class="text-2xl">üåô</span>
                    </div>
                    <div class="text-xl font-bold text-indigo-900 mb-2">21h00 - 06h00</div>
                    <p class="text-sm text-gray-600 mb-4">D√©finition l√©gale pour les s√©dentaires (sauf accord sp√©cifique).</p>
                    <div class="space-y-2 text-sm">
                        <p><strong>Statut "Travailleur de Nuit":</strong></p>
                        <ul class="list-disc list-inside text-gray-600 pl-2">
                            <li>2x/semaine (min 3h)</li>
                            <li>Ou 270h / an</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Interactive Concept: TTE -->
            <div class="bg-white rounded-xl p-8 card-shadow">
                <h3 class="font-bold text-xl mb-4">Temps de Travail Effectif (TTE)</h3>
                <p class="mb-4 text-gray-600">Le salari√© est √† disposition de l'employeur. Testez vos connaissances :</p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="p-4 bg-green-50 rounded border border-green-200">
                        <h4 class="font-bold text-green-800 mb-2">‚úÖ Inclus (TTE)</h4>
                        <ul class="space-y-1 text-sm text-green-900">
                            <li>‚Ä¢ Pr√©paration de commande</li>
                            <li>‚Ä¢ Conduite de chariot</li>
                            <li>‚Ä¢ Nettoyage de zone</li>
                            <li>‚Ä¢ Attente de directives</li>
                        </ul>
                    </div>
                    <div class="p-4 bg-gray-50 rounded border border-gray-200">
                        <h4 class="font-bold text-gray-800 mb-2">‚ùå Exclus (Non TTE)</h4>
                        <ul class="space-y-1 text-sm text-gray-700">
                            <li>‚Ä¢ Trajet domicile-travail</li>
                            <li>‚Ä¢ Pause (si libert√© totale)</li>
                            <li>‚Ä¢ Habillage (sauf convention)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- View: Transport (Roulant) -->
        <section id="view-transport" class="hidden animate-fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-blue-900">Le Transport Routier (RSE)</h2>
                <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-4">
                    <p class="text-blue-900 font-semibold">D√©finition : RSE</p>
                    <p class="text-sm text-blue-800">Dans ce contexte, RSE signifie <strong>R√©glementation Sociale Europ√©enne</strong> (R√®glement CE 561/2006) et non Responsabilit√© Soci√©tale des Entreprises.</p>
                </div>
                <p class="text-gray-600 mt-2">Le conducteur n'est pas un s√©dentaire. Ici, le chronotachygraphe fait la loi.</p>
            </div>

            <div class="grid lg:grid-cols-2 gap-8 mb-8">
                <!-- Interactive Dashboard Limits -->
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">üöõ Limites de Conduite <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded">RSE 561/2006</span></h3>
                    
                    <div class="space-y-6">
                        <!-- Conduite Continue -->
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium">Conduite Continue Max</span>
                                <span class="font-bold text-blue-600">4h30</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div class="bg-blue-600 h-4 rounded-full" style="width: 100%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Apr√®s 4h30, pause obligatoire d'au moins 45 min (ou 15 + 30).</p>
                        </div>

                        <!-- Repos Journalier -->
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium">Repos Journalier Normal</span>
                                <span class="font-bold text-green-600">11h00</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-4 relative">
                                <div class="bg-green-500 h-4 rounded-full absolute top-0 left-0" style="width: 100%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Peut √™tre r√©duit √† 9h (3 fois par semaine max).</p>
                        </div>

                         <!-- Conduite Hebdo -->
                         <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium">Max Hebdomadaire</span>
                                <span class="font-bold text-purple-600">56h00</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div class="bg-purple-600 h-4 rounded-full" style="width: 62%"></div> <!-- 56/90 scale roughly -->
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Max 90h sur 2 semaines cons√©cutives.</p>
                        </div>
                    </div>
                </div>

                <!-- Distinction Service vs Attente -->
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">‚è±Ô∏è Symboles Tachygraphe & Temps</h3>
                    <div class="flex flex-col gap-4">
                        <div class="p-4 border rounded-lg bg-gray-50 hover:bg-white transition cursor-pointer">
                            <h4 class="font-bold text-gray-800">Temps de Service (Marteaux)</h4>
                            <p class="text-sm text-gray-600">Travaux divers (Chargement, B√¢chage, Papiers).</p>
                            <div class="mt-2 text-xs font-bold text-red-600">Max Jour : 12h</div>
                        </div>
                        
                        <div class="p-4 border rounded-lg bg-gray-50 hover:bg-white transition cursor-pointer">
                            <h4 class="font-bold text-gray-800">Temps d'Attente (Carr√© Barr√©)</h4>
                            <p class="text-sm text-gray-600">Attente au quai, vigilance sans t√¢che active. <strong>Ce n'est pas de la conduite.</strong></p>
                        </div>

                        <!-- Repos/Pause Block -->
                        <div class="p-4 border border-green-200 bg-green-50 rounded-lg">
                            <h4 class="font-bold text-green-900">Repos & Pauses (Lit)</h4>
                            <p class="text-sm text-green-800">Coupures et repos (libre de tout service).</p>
                            <div class="mt-2 text-xs font-bold text-green-700 flex items-center gap-2">
                                <span>Symbole Tachygraphe :</span>
                                <span class="text-lg">üõèÔ∏è (Lit)</span>
                            </div>
                        </div>

                        <div class="p-4 border border-indigo-200 bg-indigo-50 rounded-lg">
                            <h4 class="font-bold text-indigo-900">‚ö†Ô∏è La Guillotine de Nuit (Transport)</h4>
                            <p class="text-sm text-indigo-800">Si travail entre <strong class="underline">22h00 et 05h00</strong> :</p>
                            <p class="text-sm font-bold mt-1 text-red-600">‚Üí Service Journalier Max r√©duit √† 10h (au lieu de 12h).</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- View: Methods & Calculations (NEW) -->
        <section id="view-methods" class="hidden animate-fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-blue-900">M√©thodes de Calcul & Performance</h2>
                <p class="text-gray-600 mt-2">Le c≈ìur du m√©tier TSMEL : savoir transformer une charge de travail en besoin humain (ETP) et mesurer l'efficacit√© (Engagement).</p>
            </div>

            <div class="grid lg:grid-cols-2 gap-8 mb-8">
                <!-- ETP Course -->
                <div class="bg-white p-6 rounded-xl card-shadow border-t-4 border-orange-500">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="p-2 bg-orange-100 rounded-lg text-orange-600 font-bold">1</div>
                        <h3 class="font-bold text-lg text-gray-800">Le Calcul des ETP</h3>
                    </div>
                    
                    <p class="text-sm text-gray-600 mb-4">L'√âquivalent Temps Plein (ETP) est l'unit√© de mesure de la capacit√© de travail. Il permet d'harmoniser les temps partiels et les contrats divers.</p>
                    
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4 font-mono text-sm">
                        <p class="font-bold text-gray-700 mb-2">// La Formule Fondamentale</p>
                        <p class="text-blue-600">ETP = Charge de travail (Heures) / Dur√©e L√©gale (Heures)</p>
                    </div>

                    <h4 class="font-bold text-gray-800 text-sm mb-2">Les Constantes Temporelles √† conna√Ætre :</h4>
                    <ul class="text-sm space-y-2 text-gray-600">
                        <li class="flex justify-between border-b pb-1">
                            <span>Hebdomadaire</span>
                            <span class="font-bold">35 Heures</span>
                        </li>
                        <li class="flex justify-between border-b pb-1">
                            <span>Mensuel (Base paie)</span>
                            <span class="font-bold">151,67 Heures</span>
                            <span class="text-xs text-gray-400 self-center">(35 √ó 52 / 12)</span>
                        </li>
                        <li class="flex justify-between border-b pb-1">
                            <span>Annuel (Plafond)</span>
                            <span class="font-bold">1 607 Heures</span>
                        </li>
                    </ul>
                </div>

                <!-- Coefficient Engagement Course -->
                <div class="bg-white p-6 rounded-xl card-shadow border-t-4 border-green-500">
                     <div class="flex items-center gap-3 mb-4">
                        <div class="p-2 bg-green-100 rounded-lg text-green-600 font-bold">2</div>
                        <h3 class="font-bold text-lg text-gray-800">Le Coefficient d'Engagement</h3>
                    </div>

                    <p class="text-sm text-gray-600 mb-4">Il mesure la densit√© du travail. C'est le rapport entre le temps "vendu" (ou allou√© par les standards) et le temps "pay√©" (pr√©sence).</p>

                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4 font-mono text-sm">
                        <p class="font-bold text-gray-700 mb-2">// La Formule de Performance</p>
                        <p class="text-blue-600">Coeff = Heures Allou√©es (Gamme) / Heures Pay√©es</p>
                    </div>

                    <h4 class="font-bold text-gray-800 text-sm mb-2">Grille d'Analyse TSMEL :</h4>
                    <div class="space-y-3">
                        <div class="flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full bg-red-500"></div>
                            <div class="text-sm">
                                <span class="font-bold text-red-700">&lt; 85% : Sous-activit√© (Surcapacit√©)</span>
                                <p class="text-xs text-gray-500">L'√©quipe attend le travail. Gaspillage financier.</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full bg-green-500"></div>
                            <div class="text-sm">
                                <span class="font-bold text-green-700">85% - 95% : Zone Optimale</span>
                                <p class="text-xs text-gray-500">Bonne productivit√©, absorbe les micro-pauses.</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full bg-orange-500"></div>
                            <div class="text-sm">
                                <span class="font-bold text-orange-700">&gt; 100% : Sur-activit√© (Sous-capacit√©)</span>
                                <p class="text-xs text-gray-500">Standards inatteignables ou heures supp non d√©clar√©es. Danger qualit√©/s√©curit√©.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- View: Simulator & Case Studies (UPDATED) -->
        <section id="view-simulator" class="hidden animate-fade-in">
            <div class="mb-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-blue-900">Simulateurs & Cas Pratiques</h2>
                    <p class="text-gray-600 mt-2">Mise en application concr√®te.</p>
                </div>
                <!-- Sub-nav for Cases -->
                <div class="bg-white rounded-lg p-1 border inline-flex">
                    <button onclick="app.switchSim('tropik')" id="btn-tropik" class="px-4 py-2 rounded-md text-sm font-bold bg-blue-100 text-blue-900 shadow-sm transition-all">Tropik Drive (ETP)</button>
                    <button onclick="app.switchSim('logisti')" id="btn-logisti" class="px-4 py-2 rounded-md text-sm font-medium text-gray-500 hover:text-blue-900 transition-all flex items-center gap-2">
                        <span>üö® Le Crash LogistiTech</span>
                        <span class="bg-orange-500 text-white text-[10px] px-1 rounded">Nouveau</span>
                    </button>
                </div>
            </div>

            <!-- TAB 1: Tropik Drive (Existing) -->
            <div id="sim-tropik" class="grid lg:grid-cols-3 gap-8">
                <!-- Inputs Column -->
                <div class="bg-white p-6 rounded-xl card-shadow lg:col-span-1">
                    <h3 class="font-bold text-lg mb-4 text-gray-800 border-b pb-2">Donn√©es Op√©rationnelles</h3>
                    
                    <div class="space-y-4">
                        <div class="group">
                            <label class="block text-xs font-semibold text-gray-500 uppercase">Volume R√©ception (Palettes)</label>
                            <input type="number" id="input-vol-rec" value="180" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 transition p-2 border">
                        </div>
                        <div class="group">
                            <label class="block text-xs font-semibold text-gray-500 uppercase">TU R√©ception (min/pal)</label>
                            <input type="number" id="input-tu-rec" value="8" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 transition p-2 border">
                        </div>

                        <hr class="border-gray-100">

                        <div class="group">
                            <label class="block text-xs font-semibold text-gray-500 uppercase">Volume Pr√©paration (Colis)</label>
                            <input type="number" id="input-vol-prep" value="1200" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 transition p-2 border">
                        </div>
                        <div class="group">
                            <label class="block text-xs font-semibold text-gray-500 uppercase">TU Pr√©paration (min/colis)</label>
                            <input type="number" id="input-tu-prep" value="5" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 transition p-2 border">
                        </div>

                        <hr class="border-gray-100">

                        <div class="group">
                            <label class="block text-xs font-semibold text-gray-500 uppercase">Volume Exp√©dition (Palettes)</label>
                            <input type="number" id="input-vol-exp" value="200" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 transition p-2 border">
                        </div>
                        <div class="group">
                            <label class="block text-xs font-semibold text-gray-500 uppercase">TU Exp√©dition (min/pal)</label>
                            <input type="number" id="input-tu-exp" value="6" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 transition p-2 border">
                        </div>
                        
                        <div class="mt-4 p-3 bg-blue-50 rounded text-sm text-blue-800">
                            <strong>Note TSMEL :</strong> Modifier les TU (Temps Unitaires) impacte directement le coefficient d'engagement.
                        </div>
                    </div>
                </div>

                <!-- Visualization Column -->
                <div class="bg-white p-6 rounded-xl card-shadow lg:col-span-2 flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg text-gray-800">Analyse Charge vs Capacit√©</h3>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium text-gray-600">Crash Test (Incident Mercredi)</span>
                            <button id="toggle-incident" class="bg-gray-200 relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" role="switch" aria-checked="false">
                                <span aria-hidden="true" class="translate-x-0 pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"></span>
                            </button>
                        </div>
                    </div>

                    <!-- Chart Container -->
                    <div class="chart-container w-full flex-grow">
                        <canvas id="etpChart"></canvas>
                    </div>

                    <!-- Results Summary -->
                    <div class="grid grid-cols-3 gap-4 mt-6 pt-4 border-t">
                        <div class="text-center">
                            <p class="text-xs text-gray-500 uppercase">Heures Requises</p>
                            <p id="res-hours" class="text-2xl font-bold text-blue-600">144.0 H</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-500 uppercase">ETP Calcul√©s</p>
                            <p id="res-etp" class="text-2xl font-bold text-orange-600">4.11</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-500 uppercase">Effectif Actuel</p>
                            <p class="text-2xl font-bold text-gray-400">12.00</p>
                        </div>
                    </div>

                    <div id="incident-alert" class="hidden mt-4 bg-red-50 border border-red-200 p-3 rounded-lg flex items-start space-x-3 animate-pulse">
                        <span class="text-2xl">üö®</span>
                        <div>
                            <p class="text-red-800 font-bold text-sm">Alerte Incident Mercredi !</p>
                            <p class="text-red-700 text-xs">+8h R√©ception (Camion impr√©vu) + 4h Cross-dock. Charge Totale passe √† 36h sur la journ√©e. Solution : Polyvalence (Mobilisation des polyvalents et caristes sur R√©ception puis Exp√©).</p>
                        </div>
                    </div>
                    <div id="analysis-text" class="mt-4 bg-yellow-50 border border-yellow-200 p-3 rounded-lg">
                        <p class="text-yellow-800 font-bold text-sm">Diagnostic : Surcapacit√© Structurelle</p>
                        <p class="text-yellow-700 text-xs">Avec 4.11 ETP requis pour 12 pr√©sents, le coefficient d'engagement est de 34%. Attention au co√ªt ! V√©rifiez vos standards (5 min/colis est lent).</p>
                    </div>
                </div>
            </div>

            <!-- TAB 2: LogistiTech (New Case Study Module - Inserted) -->
            <div id="sim-logisti" class="hidden">
                <div class="log-module">

                    <div class="log-header">
                        <h1>√âtude de Cas : Le Crash de LogistiTech</h1>
                        <p>Niveau : TSMEL / TLE - Gestion de Crise & Co√ªts</p>
                    </div>
                
                    <h2 class="log-h2">1. La Mission (Briefing)</h2>
                    <div class="falc-box">
                        <h3>üö® URGENCE 14 D√âCEMBRE</h3>
                        <p><strong>Le Probl√®me :</strong> Panne informatique de 3 heures ce matin. Tout a √©t√© bloqu√©.</p>
                        <p><strong>L'Impact :</strong> 450 commandes urgentes sont en retard. Le client attend.</p>
                        <p><strong>Votre Objectif :</strong> Pr√©senter une solution chiffr√©e au directeur (M. Morel) pour sauver la situation.</p>
                    </div>
                
                    <h2 class="log-h2">2. Les Donn√©es (Vos outils)</h2>
                    <p>Utilisez ces chiffres pour remplir la partie "Hypoth√®ses" de votre fichier Excel.</p>
                    
                    <table class="excel-table">
                        <thead>
                            <tr>
                                <th>Donn√©e</th>
                                <th>Valeur</th>
                                <th>Unit√©</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>√âquipe pr√©sente</td>
                                <td class="input-cell">20</td>
                                <td>Personnes</td>
                            </tr>
                            <tr>
                                <td>Productivit√© (Cadence)</td>
                                <td class="input-cell">15</td>
                                <td>Lignes / heure</td>
                            </tr>
                            <tr>
                                <td>Volume en retard</td>
                                <td class="input-cell">450</td>
                                <td>Commandes</td>
                            </tr>
                            <tr>
                                <td>Taille commande moy.</td>
                                <td class="input-cell">2</td>
                                <td>Lignes / cde</td>
                            </tr>
                            <tr>
                                <td>Co√ªt Transport Classique</td>
                                <td class="input-cell">8,00 ‚Ç¨</td>
                                <td>par colis</td>
                            </tr>
                            <tr>
                                <td>P√©nalit√© Retard</td>
                                <td class="input-cell">15,00 ‚Ç¨</td>
                                <td>par jour</td>
                            </tr>
                            <tr>
                                <td>Co√ªt Transport Express</td>
                                <td class="input-cell">22,00 ‚Ç¨</td>
                                <td>par colis</td>
                            </tr>
                        </tbody>
                    </table>
                
                    <br>
                    <div class="alert-box">
                        üí° <strong>Conseil du formateur :</strong> Commencez par calculer le volume total de lignes (450 x 2) avant de calculer le temps de travail.
                    </div>

                    <!-- NEW: CONSIGNES SECTION -->
                    <h2 class="log-h2">3. Consignes & Travail √† R√©aliser sur un fichier EXCEL OU GOOGLE SHEETS</h2>
                    
                    <div class="work-box border-l-4 border-blue-400">
                        <h3 class="font-bold text-blue-900 mb-2">√âtape 1 : Le Planning (Temps)</h3>
                        <p class="text-sm text-gray-700 mb-2">Reproduisez et compl√©tez ce tableau de calcul :</p>
                        <table class="excel-table">
                            <thead>
                                <tr>
                                    <th>Libell√©</th>
                                    <th>Calcul (Formule)</th>
                                    <th>R√©sultat</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="h-8 bg-white border border-gray-200"></td>
                                    <td class="h-8 bg-white border border-gray-200"></td>
                                    <td class="h-8 bg-white border border-gray-200"></td>
                                </tr>
                                <tr>
                                    <td class="h-8 bg-white border border-gray-200"></td>
                                    <td class="h-8 bg-white border border-gray-200"></td>
                                    <td class="h-8 bg-white border border-gray-200"></td>
                                </tr>
                                <tr>
                                    <td class="h-8 bg-white border border-gray-200"></td>
                                    <td class="h-8 bg-white border border-gray-200"></td>
                                    <td class="h-8 bg-white border border-gray-200"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="work-box border-l-4 border-green-400">
                        <h3 class="font-bold text-green-900 mb-2">√âtape 2 : Le Choix Financier</h3>
                        <p class="text-sm text-gray-700 mb-4">Calculez le co√ªt total pour chaque option et choisissez la meilleure strat√©gie (Co√ªt vs D√©lai).</p>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-white p-4 border rounded shadow-sm">
                                <h4 class="font-bold text-gray-800 border-b pb-1 mb-2">Option A : Classique (J+2)</h4>
                                <ul class="text-sm space-y-2 text-gray-600">
                                    <li>Co√ªt Transport : ...... ‚Ç¨</li>
                                    <li>P√©nalit√©s Retard : ...... ‚Ç¨</li>
                                    <li class="font-bold pt-2">TOTAL : ...... ‚Ç¨</li>
                                </ul>
                            </div>
                            <div class="bg-white p-4 border rounded shadow-sm">
                                <h4 class="font-bold text-gray-800 border-b pb-1 mb-2">Option B : Express (J+1)</h4>
                                <ul class="text-sm space-y-2 text-gray-600">
                                    <li>Co√ªt Transport : ...... ‚Ç¨</li>
                                    <li>P√©nalit√©s Retard : 0 ‚Ç¨</li>
                                    <li class="font-bold pt-2">TOTAL : ...... ‚Ç¨</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="work-box border-l-4 border-purple-400">
                        <h3 class="font-bold text-purple-900 mb-2">√âtape 3 : Le Point Mort (Expert)</h3>
                        <p class="text-sm text-gray-700 mb-2">D√©terminez graphiquement ou par le calcul √† partir de quel prix l'Express devient moins rentable que la p√©nalit√©.</p>
                        
                        <div class="bg-white p-2 rounded border" style="height: 300px;">
                            <canvas id="breakEvenChart"></canvas>
                        </div>
                        <p class="text-xs text-gray-500 mt-2 text-center"><em>Graphique de Rentabilit√© : Intersection = Seuil de bascule</em></p>
                    </div>
                
                    <h2 class="log-h2 cursor-pointer hover:text-blue-600 transition" onclick="app.focusCodeInput()">
                        <i class="fa-solid fa-lock"></i> 4. Le Corrig√© Type
                    </h2>

                    <!-- Interface de verrouillage -->
                    <div id="lock-interface" class="locked-overlay">
                        <i class="fa-solid fa-user-lock text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-bold text-gray-700 mb-2">Contenu Verrouill√©</h3>
                        <p class="text-sm text-gray-500 mb-4">Entrez le code formateur pour acc√©der √† la correction d√©taill√©e.</p>
                        
                        <div class="flex justify-center items-center gap-2 max-w-xs mx-auto">
                            <input type="password" id="secret-code" maxlength="4" placeholder="Code (4 chiffres)" 
                                   class="text-center text-lg tracking-widest w-40 border-2 border-gray-300 rounded-lg p-2 focus:border-blue-500 focus:outline-none transition">
                            <button onclick="app.checkCode()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition shadow-sm">
                                <i class="fa-solid fa-key"></i>
                            </button>
                        </div>
                        <p id="error-msg" class="text-red-500 text-xs mt-2 font-bold hidden animate-pulse">Code incorrect. R√©essayez.</p>
                    </div>

                    <!-- Contenu D√©verrouill√© (Cach√© par d√©faut) -->
                    <div id="unlocked-content" class="hidden animate-fade-in bg-green-50 rounded-xl p-6 border border-green-200 mt-4">
                        <div class="flex justify-between items-center mb-4 border-b border-green-200 pb-2">
                            <h3 class="font-bold text-green-800"><i class="fa-solid fa-check-circle mr-2"></i>Correction d√©taill√©e</h3>
                            <button onclick="app.lockContent()" class="text-xs text-green-600 hover:underline">Verrouiller</button>
                        </div>

                        <!-- √âtape 1 -->
                        <div class="mb-6">
                            <h4 class="font-bold text-gray-800 text-sm uppercase mb-2 bg-white inline-block px-2 py-1 rounded border">√âtape 1 : Le Planning (Temps)</h4>
                            <table class="excel-table bg-white shadow-sm">
                                <thead>
                                    <tr>
                                        <th>Libell√©</th>
                                        <th>Formule de Calcul</th>
                                        <th>R√©sultat</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Volume Total (Lignes)</td>
                                        <td class="formula-col">450 cdes √ó 2 lignes</td>
                                        <td class="result-cell">900 Lignes</td>
                                    </tr>
                                    <tr>
                                        <td>Capacit√© √âquipe / heure</td>
                                        <td class="formula-col">20 pers. √ó 15 lignes/h</td>
                                        <td class="result-cell">300 Lignes/h</td>
                                    </tr>
                                    <tr class="bg-blue-50">
                                        <td><strong>Temps n√©cessaire</strong></td>
                                        <td class="formula-col">900 √∑ 300</td>
                                        <td class="result-cell text-blue-700">3,00 Heures</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="text-xs text-gray-500 mt-2 italic"><i class="fa-solid fa-comment-dots"></i> Analyse : Reprise √† 12h45 + 3h de travail = Fin √† 15h45. Pas d'heures sup n√©cessaires !</p>
                        </div>
                    
                        <!-- √âtape 2 -->
                        <div class="mb-6">
                            <h4 class="font-bold text-gray-800 text-sm uppercase mb-2 bg-white inline-block px-2 py-1 rounded border">√âtape 2 : Le Choix Financier</h4>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="bg-white p-4 rounded border border-red-200 shadow-sm opacity-75">
                                    <h5 class="font-bold text-red-800">Option A : Classique (J+2)</h5>
                                    <p class="text-sm text-gray-600 mt-2">Le client re√ßoit sa commande en retard.</p>
                                    <ul class="text-xs mt-2 space-y-1">
                                        <li>Transport : 450 √ó 8‚Ç¨ = 3 600 ‚Ç¨</li>
                                        <li>P√©nalit√©s : 450 √ó 15‚Ç¨ = 6 750 ‚Ç¨</li>
                                    </ul>
                                    <div class="mt-3 text-xl font-bold text-red-600 border-t pt-2">Total : 10 350 ‚Ç¨</div>
                                </div>

                                <div class="bg-white p-4 rounded border-2 border-green-500 shadow-md relative overflow-hidden">
                                    <div class="absolute top-0 right-0 bg-green-500 text-white text-[10px] px-2 py-1 font-bold uppercase">Recommand√©</div>
                                    <h5 class="font-bold text-green-800">Option B : Express (J+1)</h5>
                                    <p class="text-sm text-gray-600 mt-2">Le client est livr√© √† temps (Promesse tenue).</p>
                                    <ul class="text-xs mt-2 space-y-1">
                                        <li>Transport : 450 √ó 22‚Ç¨ = 9 900 ‚Ç¨</li>
                                        <li>P√©nalit√©s : 0 ‚Ç¨</li>
                                    </ul>
                                    <div class="mt-3 text-xl font-bold text-green-600 border-t pt-2">Total : 9 900 ‚Ç¨</div>
                                </div>
                            </div>
                            <div class="mt-2 text-center text-sm font-bold text-green-700 bg-green-100 p-2 rounded">
                                Gain financier : 450 ‚Ç¨ + Satisfaction Client sauv√©e (NPS)
                            </div>
                        </div>

                        <!-- √âtape 3 -->
                        <div>
                            <h4 class="font-bold text-gray-800 text-sm uppercase mb-2 bg-white inline-block px-2 py-1 rounded border">√âtape 3 : Le Point Mort (Expert)</h4>
                            <p class="text-sm text-gray-700 mb-2">√Ä quel prix l'Express devient-il plus cher que la p√©nalit√© ?</p>
                            <div class="bg-gray-800 text-white p-3 rounded text-center font-mono">
                                Seuil = Co√ªt Classique (8‚Ç¨) + P√©nalit√© (15‚Ç¨) = <span class="text-yellow-400 font-bold">23,00 ‚Ç¨</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Tant que l'express co√ªte moins de 23‚Ç¨, c'est rentable.</p>
                        </div>
                    </div>
                
                </div>
            </div>
        </section>

        <!-- View: Synthesis (Comparatif Only) -->
        <section id="view-synthesis" class="hidden animate-fade-in">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-blue-900">Synth√®se & Comparatif</h2>
                <p class="text-gray-600 mt-2">L'outil de r√©vision indispensable. Comparez les r√®gles s√©dentaires et roulantes en un coup d'≈ìil.</p>
            </div>

            <!-- Comparison Table -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-blue-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-blue-900 uppercase tracking-wider">Th√®me</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-blue-900 uppercase tracking-wider">S√©dentaire (Entrep√¥t)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-blue-900 uppercase tracking-wider">Roulant (Transport > 3.5t)</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-sm">
                            <tr class="hover:bg-gray-50 transition cursor-pointer group">
                                <td class="px-6 py-4 font-bold text-gray-900">Base Hebdo</td>
                                <td class="px-6 py-4 text-gray-600">35h (Moyenne)</td>
                                <td class="px-6 py-4 text-gray-600 group-hover:text-blue-600">35h / 39h / 43h (√âquivalences)</td>
                            </tr>
                            <tr class="hover:bg-gray-50 transition cursor-pointer group">
                                <td class="px-6 py-4 font-bold text-gray-900">Pause Obligatoire</td>
                                <td class="px-6 py-4 text-gray-600 bg-green-50">20 min apr√®s 6h travail</td>
                                <td class="px-6 py-4 text-gray-600 bg-orange-50 group-hover:font-bold">45 min apr√®s 4h30 conduite</td>
                            </tr>
                            <tr class="hover:bg-gray-50 transition cursor-pointer group">
                                <td class="px-6 py-4 font-bold text-gray-900">Travail de Nuit</td>
                                <td class="px-6 py-4 text-gray-600">21h00 - 06h00</td>
                                <td class="px-6 py-4 text-gray-600 group-hover:text-blue-600">22h00 - 05h00</td>
                            </tr>
                            <tr class="hover:bg-gray-50 transition cursor-pointer group">
                                <td class="px-6 py-4 font-bold text-gray-900">Sanction Nuit</td>
                                <td class="px-6 py-4 text-gray-600">Majoration salaire / Repos</td>
                                <td class="px-6 py-4 text-gray-600 text-red-600 font-semibold">Service Jour limit√© √† 10h MAX</td>
                            </tr>
                            <tr class="hover:bg-gray-50 transition cursor-pointer group">
                                <td class="px-6 py-4 font-bold text-gray-900">Contr√¥le</td>
                                <td class="px-6 py-4 text-gray-600">Badgeuse</td>
                                <td class="px-6 py-4 text-gray-600">Chronotachygraphe</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Conclusion Quote -->
            <div class="bg-blue-900 text-white p-8 rounded-xl text-center shadow-lg">
                <p class="text-xl italic font-serif mb-4">"L'agilit√© (modulation, polyvalence) est votre meilleure arme face √† la rigidit√© des lois."</p>
                <div class="h-1 w-20 bg-orange-500 mx-auto rounded"></div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-300 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center text-sm">
            <p>¬© 2025 Module TSMEL - Support de Cours Interactif.</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- State Management ---
        const app = {
            currentView: 'home',
            data: {
                reception: { vol: 180, tu: 8 },
                prep: { vol: 1200, tu: 5 },
                expedition: { vol: 200, tu: 6 },
                incidentActive: false,
                isUnlocked: false // State for LogistiTech Lock
            },
            navItems: [
                { id: 'home', label: 'üè† Accueil' },
                { id: 'warehouse', label: 'üè≠ Entrep√¥t (S√©dentaire)' },
                { id: 'transport', label: 'üöõ Transport (Roulant)' },
                { id: 'methods', label: 'üìê M√©thodes & Calculs' },
                { id: 'simulator', label: 'üßÆ Simulateurs & Cas' },
                { id: 'synthesis', label: 'üìã Synth√®se' }
            ],
            
            // --- Navigation Logic ---
            init: function() {
                this.renderNav();
                this.navigate('home');
                this.setupListeners();
                this.initChart();
                this.calculateETP(); // Initial calc for Tropik
                
                // Listener for Lock Code Enter key
                const codeInput = document.getElementById('secret-code');
                if(codeInput) {
                    codeInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') this.checkCode();
                    });
                }
            },

            renderNav: function() {
                const navContainer = document.getElementById('nav-container');
                navContainer.innerHTML = this.navItems.map(item => `
                    <button 
                        onclick="app.navigate('${item.id}')" 
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 tab-inactive"
                        id="nav-${item.id}"
                    >
                        ${item.label}
                    </button>
                `).join('');
            },

            navigate: function(viewId) {
                document.querySelectorAll('section[id^="view-"]').forEach(el => el.classList.add('hidden'));
                document.getElementById(`view-${viewId}`).classList.remove('hidden');
                
                this.navItems.forEach(item => {
                    const btn = document.getElementById(`nav-${item.id}`);
                    if(item.id === viewId) {
                        btn.classList.remove('tab-inactive');
                        btn.classList.add('tab-active');
                    } else {
                        btn.classList.add('tab-inactive');
                        btn.classList.remove('tab-active');
                    }
                });

                this.currentView = viewId;
                window.scrollTo(0,0);
                
                // Init Case Study Chart only if navigating to simulator section (simple optimization)
                if(viewId === 'simulator' && !this.breakEvenChartInstance) {
                    // Small timeout to ensure DOM is ready if inside hidden div logic
                    setTimeout(() => this.initBreakEvenChart(), 100);
                }
            },

            // --- Simulator Switching Logic ---
            switchSim: function(simId) {
                if(simId === 'tropik') {
                    document.getElementById('sim-tropik').classList.remove('hidden');
                    document.getElementById('sim-logisti').classList.add('hidden');
                    document.getElementById('btn-tropik').className = "px-4 py-2 rounded-md text-sm font-bold bg-blue-100 text-blue-900 shadow-sm transition-all";
                    document.getElementById('btn-logisti').className = "px-4 py-2 rounded-md text-sm font-medium text-gray-500 hover:text-blue-900 transition-all flex items-center gap-2";
                } else {
                    document.getElementById('sim-tropik').classList.add('hidden');
                    document.getElementById('sim-logisti').classList.remove('hidden');
                    document.getElementById('btn-tropik').className = "px-4 py-2 rounded-md text-sm font-medium text-gray-500 hover:text-blue-900 transition-all";
                    document.getElementById('btn-logisti').className = "px-4 py-2 rounded-md text-sm font-bold bg-blue-100 text-blue-900 shadow-sm transition-all flex items-center gap-2";
                    
                    if(!this.breakEvenChartInstance) {
                         this.initBreakEvenChart();
                    }
                }
            },

            // --- LogistiTech Lock Logic ---
            focusCodeInput: function() {
                if(!this.data.isUnlocked) {
                    document.getElementById('secret-code').focus();
                }
            },

            checkCode: function() {
                const codeInput = document.getElementById('secret-code');
                const errorMsg = document.getElementById('error-msg');
                
                if (codeInput.value === '0606') {
                    this.data.isUnlocked = true;
                    errorMsg.classList.add('hidden');
                    document.getElementById('lock-interface').classList.add('hidden');
                    document.getElementById('unlocked-content').classList.remove('hidden');
                } else {
                    errorMsg.classList.remove('hidden');
                    codeInput.value = '';
                    codeInput.focus();
                }
            },
            
            lockContent: function() {
                this.data.isUnlocked = false;
                document.getElementById('unlocked-content').classList.add('hidden');
                document.getElementById('lock-interface').classList.remove('hidden');
                document.getElementById('secret-code').value = '';
                document.getElementById('error-msg').classList.add('hidden');
            },

            // --- Tropik Drive Logic ---
            setupListeners: function() {
                // Tropik Inputs
                ['input-vol-rec', 'input-tu-rec', 'input-vol-prep', 'input-tu-prep', 'input-vol-exp', 'input-tu-exp'].forEach(id => {
                    const el = document.getElementById(id);
                    if(el) el.addEventListener('input', () => this.updateData());
                });

                // Incident Toggle
                const toggle = document.getElementById('toggle-incident');
                if(toggle) {
                    toggle.addEventListener('click', () => {
                        this.data.incidentActive = !this.data.incidentActive;
                        const knob = toggle.querySelector('span');
                        if(this.data.incidentActive) {
                            toggle.classList.remove('bg-gray-200');
                            toggle.classList.add('bg-orange-500');
                            knob.classList.add('translate-x-5');
                            document.getElementById('incident-alert').classList.remove('hidden');
                        } else {
                            toggle.classList.add('bg-gray-200');
                            toggle.classList.remove('bg-orange-500');
                            knob.classList.remove('translate-x-5');
                            document.getElementById('incident-alert').classList.add('hidden');
                        }
                        this.calculateETP();
                    });
                }
            },

            updateData: function() {
                this.data.reception.vol = parseFloat(document.getElementById('input-vol-rec').value) || 0;
                this.data.reception.tu = parseFloat(document.getElementById('input-tu-rec').value) || 0;
                this.data.prep.vol = parseFloat(document.getElementById('input-vol-prep').value) || 0;
                this.data.prep.tu = parseFloat(document.getElementById('input-tu-prep').value) || 0;
                this.data.expedition.vol = parseFloat(document.getElementById('input-vol-exp').value) || 0;
                this.data.expedition.tu = parseFloat(document.getElementById('input-tu-exp').value) || 0;
                this.calculateETP();
            },

            calculateETP: function() {
                const recMins = this.data.reception.vol * this.data.reception.tu;
                const prepMins = this.data.prep.vol * this.data.prep.tu;
                const expMins = this.data.expedition.vol * this.data.expedition.tu;
                let totalHours = (recMins + prepMins + expMins) / 60;
                
                let incidentHours = 0;
                if(this.data.incidentActive) {
                    incidentHours = 12; // Matches text description: 8h reception + 4h crossdock
                    totalHours += incidentHours;
                }

                const etpRequired = totalHours / 35;
                const existingETP = 12;

                const resHours = document.getElementById('res-hours');
                const resEtp = document.getElementById('res-etp');
                if(resHours) resHours.innerText = totalHours.toFixed(1) + " H";
                if(resEtp) resEtp.innerText = etpRequired.toFixed(2);
                
                const analysisEl = document.getElementById('analysis-text');
                if(analysisEl) {
                    const occupation = (etpRequired / existingETP) * 100;
                    if (occupation > 110) {
                        analysisEl.innerHTML = `<p class="text-red-800 font-bold text-sm">Diagnostic : Sous-capacit√© Critique (${occupation.toFixed(0)}%)</p><p class="text-red-700 text-xs">Risque de retard livraison.</p>`;
                        analysisEl.className = "mt-4 bg-red-50 border border-red-200 p-3 rounded-lg";
                    } else if (occupation < 50) {
                        analysisEl.innerHTML = `<p class="text-yellow-800 font-bold text-sm">Diagnostic : Surcapacit√© Structurelle (${occupation.toFixed(0)}%)</p><p class="text-yellow-700 text-xs">Gaspillage financier.</p>`;
                        analysisEl.className = "mt-4 bg-yellow-50 border border-yellow-200 p-3 rounded-lg";
                    } else {
                        analysisEl.innerHTML = `<p class="text-green-800 font-bold text-sm">Diagnostic : Zone Optimale (${occupation.toFixed(0)}%)</p><p class="text-green-700 text-xs">Bonne ad√©quation.</p>`;
                        analysisEl.className = "mt-4 bg-green-50 border border-green-200 p-3 rounded-lg";
                    }
                }

                this.updateChart(totalHours, existingETP * 35, incidentHours);
            },

            // --- Chart.js Instances ---
            chartInstance: null,
            breakEvenChartInstance: null,

            initChart: function() {
                const ctx = document.getElementById('etpChart');
                if(!ctx) return;
                this.chartInstance = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Charge (H)', 'Capacit√© (H)'],
                        datasets: [
                            { label: 'Base', data: [0, 0], backgroundColor: ['#3b82f6', '#9ca3af'], borderRadius: 4, order: 2 },
                            { label: 'Incident', data: [0, 0], backgroundColor: '#f97316', borderRadius: 4, order: 1 }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } } }
                });
            },

            updateChart: function(totalNeeded, totalAvailable, incidentHours) {
                if(!this.chartInstance) return;
                const baseNeeded = totalNeeded - incidentHours;
                this.chartInstance.data.datasets[0].data = [baseNeeded, totalAvailable];
                this.chartInstance.data.datasets[1].data = [incidentHours, 0];
                this.chartInstance.update();
            },

            // --- Break Even Chart (LogistiTech) ---
            initBreakEvenChart: function() {
                const ctx = document.getElementById('breakEvenChart');
                if(!ctx) return;
                
                // We want to visualize Total Cost vs Price of Express.
                // Fixed line: Option A (Classique) = 23 (8 + 15).
                // Variable line: Option B (Express) = x (Price).
                
                // Data points for visualisation
                // X axis: Prix Express Transport (from 15 to 30)
                // Y axis: Total Cost impact (Unitary)
                
                this.breakEvenChartInstance = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['15‚Ç¨', '18‚Ç¨', '21‚Ç¨', '23‚Ç¨', '25‚Ç¨', '28‚Ç¨', '30‚Ç¨'],
                        datasets: [
                            {
                                label: 'Co√ªt Option A (Fixe: Classique + P√©nalit√©)',
                                data: [23, 23, 23, 23, 23, 23, 23],
                                borderColor: '#dc2626', // Red
                                borderWidth: 2,
                                pointRadius: 0,
                                borderDash: [5, 5]
                            },
                            {
                                label: 'Co√ªt Option B (Variable: Prix Express)',
                                data: [15, 18, 21, 23, 25, 28, 30],
                                borderColor: '#16a34a', // Green
                                borderWidth: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Co√ªt Total Unitaire (‚Ç¨)' },
                                min: 10,
                                max: 35
                            },
                            x: {
                                title: { display: true, text: 'Prix du Transport Express (‚Ç¨)' }
                            }
                        },
                        plugins: {
                            annotation: {
                                annotations: {
                                    point1: {
                                        type: 'point',
                                        xValue: '23‚Ç¨',
                                        yValue: 23,
                                        backgroundColor: 'orange',
                                        radius: 6,
                                        label: { content: 'Seuil', enabled: true }
                                    }
                                }
                            }
                        }
                    }
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => { app.init(); });
    </script>
</body>
</html>
